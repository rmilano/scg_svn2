<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">
    
<sqlMap namespace="Reporte">
     
    <resultMap id="resulMapTotalAsuntos" class="mx.gob.economia.scg.model.Reporte">
        <result property="total" column="TOTAL"/>
        <result property="pendiente" column="TRAMITE"/>
        <result property="turnado" column="PENDIENTE"/>
        <result property="atendido" column="ATENDIDO"/>
        <result property="finalizado" column="FINALIZADO"/>
    </resultMap>

    <select id="getConcentradoAsuntoEstatus" resultMap="resulMapTotalAsuntos" parameterClass="mx.gob.economia.scg.model.CriterioReporte">
        SELECT
        COUNT((
        (SELECT ST_ASUNTO.ID_ASUNTO FROM  ASUNTO ST_ASUNTO
        LEFT JOIN ASUNTO_ATENCION_PARCIAL AT ON ST_ASUNTO.ID_ASUNTO = AT.ID_ASUNTO
        WHERE ST_ASUNTO.ID_ASUNTO = INIDASUNTO AND ST_ASUNTO.ESTATUS in(0,1) AND AT.COMENTARIO is not null) UNION
        (SELECT ST_ASUNTO.ID_ASUNTO FROM  ASUNTO ST_ASUNTO
        LEFT JOIN ASUNTO_ATENCION_PARCIAL AT ON ST_ASUNTO.ID_ASUNTO = AT.ID_ASUNTO
        WHERE ST_ASUNTO.ID_ASUNTO = INIDASUNTO AND ST_ASUNTO.ESTATUS = 1 AND AT.COMENTARIO is null) UNION
        (SELECT ST_ASUNTO.ID_ASUNTO FROM  ASUNTO ST_ASUNTO WHERE ST_ASUNTO.ID_ASUNTO = INIDASUNTO AND ST_ASUNTO.ESTATUS = 2) UNION
        (SELECT ST_ASUNTO.ID_ASUNTO FROM  ASUNTO ST_ASUNTO WHERE ST_ASUNTO.ID_ASUNTO = INIDASUNTO AND ST_ASUNTO.ESTATUS = 3)
        )) TOTAL,
        COUNT((
        SELECT ST_ASUNTO.ID_ASUNTO FROM  ASUNTO ST_ASUNTO
        LEFT JOIN ASUNTO_ATENCION_PARCIAL AT ON ST_ASUNTO.ID_ASUNTO = AT.ID_ASUNTO
        WHERE ST_ASUNTO.ID_ASUNTO = INIDASUNTO AND ST_ASUNTO.ESTATUS in(0,1) AND AT.COMENTARIO is not null
        )) TRAMITE,
        COUNT((
        SELECT ST_ASUNTO.ID_ASUNTO FROM  ASUNTO ST_ASUNTO
        LEFT JOIN ASUNTO_ATENCION_PARCIAL AT ON ST_ASUNTO.ID_ASUNTO = AT.ID_ASUNTO
        WHERE ST_ASUNTO.ID_ASUNTO = INIDASUNTO AND ST_ASUNTO.ESTATUS = 1 AND AT.COMENTARIO is null
        )) PENDIENTE,
        COUNT((SELECT ST_ASUNTO.ID_ASUNTO FROM  ASUNTO ST_ASUNTO WHERE ST_ASUNTO.ID_ASUNTO = INIDASUNTO AND ST_ASUNTO.ESTATUS = 2)) ATENDIDO,
        COUNT((SELECT ST_ASUNTO.ID_ASUNTO FROM  ASUNTO ST_ASUNTO WHERE ST_ASUNTO.ID_ASUNTO = INIDASUNTO AND ST_ASUNTO.ESTATUS = 3)) FINALIZADO
        FROM
        (
        SELECT  INASUNTO.ID_ASUNTO INIDASUNTO, INASUNTO.ASUNTO, INASUNTO.ESTATUS, AREA.ID_AREA, AREA.AREA
        FROM ASUNTO INASUNTO
        INNER JOIN EMPLEADO ON INASUNTO.ID_EMPLEADO_REMI = EMPLEADO.ID_EMPLEADO
        INNER JOIN AREA ON EMPLEADO.ID_AREA = AREA.ID_AREA
        INNER JOIN EMPLEADO DESTINATARIO ON INASUNTO.ID_EMPLEADO_DEST = DESTINATARIO.ID_EMPLEADO
        INNER JOIN AREA AREADEST ON DESTINATARIO.ID_AREA = AREADEST.ID_AREA

        <isNotEmpty prepend="AND" property="ids_area">
            <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                AREA.ID_AREA =#ids_area[]#
            </iterate>
        </isNotEmpty>

        <isNotEmpty prepend="" property="id_area_dest">
            <isGreaterThan prepend="AND" property="id_area_dest" compareValue="-1">
                AREADEST.ID_AREA =#id_area_dest#
            </isGreaterThan>
        </isNotEmpty>

        <isNotNull prepend="" property="fh_registroIni">
            <isNotNull prepend="AND" property="fh_registroFin">
		  INASUNTO.FH_OFICIO BETWEEN #fh_registroIni# AND #fh_registroFin#
            </isNotNull>
        </isNotNull>
        <isNotNull prepend="" property="id_estatus">
            <isNotEqual prepend="AND" property="id_estatus" compareValue="-1">
                  INASUNTO.ESTATUS =  #id_estatus#
            </isNotEqual>
        </isNotNull>
        <isNotNull prepend="" property="id_tema">
            <isNotEqual prepend="AND" property="id_tema" compareValue="-1">
                  INASUNTO.ID_TEMA = #id_tema#
            </isNotEqual>
        </isNotNull>
        <isNotNull prepend="" property="id_expediente">
            <isNotEqual prepend="AND" property="id_expediente" compareValue="-1">
                  INASUNTO.ID_EXPEDIENTE = #id_expediente#
            </isNotEqual>
        </isNotNull>     
        AND ROWNUM <![CDATA[ <= ]]>#paginador.numMaxRegistrosReporte# 
        ) PARCIAL   
    </select>
    
    <select id="getConcentradoAsuntoEstatusPriori" resultMap="resulMapTotalAsuntos" parameterClass="mx.gob.economia.scg.model.CriterioReporte">
		SELECT
        COUNT((
        (SELECT ST_ASUNTO.ID_ASUNTO FROM  ASUNTO ST_ASUNTO
        LEFT JOIN ASUNTO_ATENCION_PARCIAL AT ON ST_ASUNTO.ID_ASUNTO = AT.ID_ASUNTO
        WHERE ST_ASUNTO.ID_ASUNTO = INIDASUNTO AND ST_ASUNTO.ESTATUS in(0,1) AND AT.COMENTARIO is not null) UNION
        (SELECT ST_ASUNTO.ID_ASUNTO FROM  ASUNTO ST_ASUNTO
        LEFT JOIN ASUNTO_ATENCION_PARCIAL AT ON ST_ASUNTO.ID_ASUNTO = AT.ID_ASUNTO
        WHERE ST_ASUNTO.ID_ASUNTO = INIDASUNTO AND ST_ASUNTO.ESTATUS = 1 AND AT.COMENTARIO is null) UNION
        (SELECT ST_ASUNTO.ID_ASUNTO FROM  ASUNTO ST_ASUNTO WHERE ST_ASUNTO.ID_ASUNTO = INIDASUNTO AND ST_ASUNTO.ESTATUS = 2) UNION
        (SELECT ST_ASUNTO.ID_ASUNTO FROM  ASUNTO ST_ASUNTO WHERE ST_ASUNTO.ID_ASUNTO = INIDASUNTO AND ST_ASUNTO.ESTATUS = 3)
        )) TOTAL,
        COUNT((
        SELECT ST_ASUNTO.ID_ASUNTO FROM  ASUNTO ST_ASUNTO
        LEFT JOIN ASUNTO_ATENCION_PARCIAL AT ON ST_ASUNTO.ID_ASUNTO = AT.ID_ASUNTO
        WHERE ST_ASUNTO.ID_ASUNTO = INIDASUNTO AND ST_ASUNTO.ESTATUS in(0,1) AND AT.COMENTARIO is not null
        )) TRAMITE,
        COUNT((
        SELECT ST_ASUNTO.ID_ASUNTO FROM  ASUNTO ST_ASUNTO
        LEFT JOIN ASUNTO_ATENCION_PARCIAL AT ON ST_ASUNTO.ID_ASUNTO = AT.ID_ASUNTO
        WHERE ST_ASUNTO.ID_ASUNTO = INIDASUNTO AND ST_ASUNTO.ESTATUS = 1 AND AT.COMENTARIO is null
        )) PENDIENTE,
        COUNT((SELECT ST_ASUNTO.ID_ASUNTO FROM  ASUNTO ST_ASUNTO WHERE ST_ASUNTO.ID_ASUNTO = INIDASUNTO AND ST_ASUNTO.ESTATUS = 2)) ATENDIDO,
        COUNT((SELECT ST_ASUNTO.ID_ASUNTO FROM  ASUNTO ST_ASUNTO WHERE ST_ASUNTO.ID_ASUNTO = INIDASUNTO AND ST_ASUNTO.ESTATUS = 3)) FINALIZADO
        FROM
        (
        (SELECT  INASUNTO.ID_ASUNTO INIDASUNTO, INASUNTO.ASUNTO, INASUNTO.ESTATUS, AREA.ID_AREA, AREA.AREA
        FROM ASUNTO INASUNTO
        INNER JOIN EMPLEADO ON INASUNTO.ID_EMPLEADO_REMI = EMPLEADO.ID_EMPLEADO
        INNER JOIN AREA ON EMPLEADO.ID_AREA = AREA.ID_AREA
        INNER JOIN EMPLEADO DESTINATARIO ON INASUNTO.ID_EMPLEADO_DEST = DESTINATARIO.ID_EMPLEADO
        INNER JOIN AREA AREADEST ON DESTINATARIO.ID_AREA = AREADEST.ID_AREA

        <isNotEmpty prepend="" property="id_area">
            <isNotNull prepend="AND" property="id_area">
                AREA.ID_AREA in (#id_area#)
            </isNotNull>
        </isNotEmpty>

        <isNotEmpty prepend="" property="id_area_dest">
            <isGreaterThan prepend="AND" property="id_area_dest" compareValue="-1">
                AREADEST.ID_AREA =#id_area_dest#
            </isGreaterThan>
        </isNotEmpty>

        <isNotNull prepend="" property="fh_registroIni">
            <isNotNull prepend="AND" property="fh_registroFin">
		  INASUNTO.FH_OFICIO BETWEEN #fh_registroIni# AND #fh_registroFin#
            </isNotNull>
        </isNotNull>
        <isNotNull prepend="" property="id_estatus">
            <isNotEqual prepend="AND" property="id_estatus" compareValue="-1">
                  INASUNTO.ESTATUS =  #id_estatus#
            </isNotEqual>
        </isNotNull>
        <isNotNull prepend="" property="id_tema">
            <isNotEqual prepend="AND" property="id_tema" compareValue="-1">
                  INASUNTO.ID_TEMA = #id_tema#
            </isNotEqual>
        </isNotNull>
        <isNotNull prepend="" property="id_expediente">
            <isNotEqual prepend="AND" property="id_expediente" compareValue="-1">
                  INASUNTO.ID_EXPEDIENTE = #id_expediente#
            </isNotEqual>
        </isNotNull>
        AND ROWNUM <![CDATA[ <= ]]>#paginador.numMaxRegistrosReporte# )

		UNION ALL
		(SELECT DISTINCT(AD.ID_ASUNTO) INIDASUNTO, INASUNTO.ASUNTO, INASUNTO.ESTATUS, AREA.ID_AREA, AREA.AREA
		FROM ASUNTO_DETALLE AD
		INNER JOIN ASUNTO INASUNTO ON AD.ID_ASUNTO = INASUNTO.ID_ASUNTO
		INNER JOIN EMPLEADO ON INASUNTO.ID_EMPLEADO_REMI = EMPLEADO.ID_EMPLEADO
		INNER JOIN AREA ON EMPLEADO.ID_AREA = AREA.ID_AREA
		INNER JOIN EMPLEADO DESTINATARIO ON INASUNTO.ID_EMPLEADO_DEST = DESTINATARIO.ID_EMPLEADO
		INNER JOIN AREA AREADEST ON DESTINATARIO.ID_AREA = AREADEST.ID_AREA
		WHERE AD.ID_ASUNTO NOT IN (SELECT DISTINCT(INASUNTO.ID_ASUNTO) INIDASUNTO
		FROM ASUNTO INASUNTO
        INNER JOIN EMPLEADO ON INASUNTO.ID_EMPLEADO_REMI = EMPLEADO.ID_EMPLEADO
		INNER JOIN AREA ON EMPLEADO.ID_AREA = AREA.ID_AREA
		INNER JOIN EMPLEADO DESTINATARIO ON INASUNTO.ID_EMPLEADO_DEST = DESTINATARIO.ID_EMPLEADO
		INNER JOIN AREA AREADEST ON DESTINATARIO.ID_AREA = AREADEST.ID_AREA

        <isNotEmpty prepend="" property="id_area">
            <isNotNull prepend="AND" property="id_area">
                AREA.ID_AREA in (#id_area#)
            </isNotNull>
        </isNotEmpty>
        <isNotNull prepend="" property="fh_registroIni">
            <isNotNull prepend="AND" property="fh_registroFin">
		  INASUNTO.FH_OFICIO BETWEEN #fh_registroIni# AND #fh_registroFin#
            </isNotNull>
        </isNotNull>
        <isNotNull prepend="" property="id_estatus">
            <isNotEqual prepend="AND" property="id_estatus" compareValue="-1">
                  INASUNTO.ESTATUS =  #id_estatus#
            </isNotEqual>
        </isNotNull>
        <isNotNull prepend="" property="id_tema">
            <isNotEqual prepend="AND" property="id_tema" compareValue="-1">
                  INASUNTO.ID_TEMA = #id_tema#
            </isNotEqual>
        </isNotNull>
        <isNotNull prepend="" property="id_expediente">
            <isNotEqual prepend="AND" property="id_expediente" compareValue="-1">
                  INASUNTO.ID_EXPEDIENTE = #id_expediente#
            </isNotEqual>
        </isNotNull>
        AND ROWNUM <![CDATA[ <= ]]>#paginador.numMaxRegistrosReporte# )

        AND (AD.ID_EMPLEADO_DEST IN(SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = #id_area#)
        OR  AD.ID_EMPLEADO_REMI IN(SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = #id_area#))

        <isNotNull prepend="" property="fh_registroIni">
            <isNotNull prepend="AND" property="fh_registroFin">
		  INASUNTO.FH_OFICIO BETWEEN #fh_registroIni# AND #fh_registroFin#
            </isNotNull>
        </isNotNull>

        )
        ) PARCIAL
    </select>
    
    <select id="countReporteGeneralDetalle" parameterClass="mx.gob.economia.scg.model.CriterioReporte" resultClass="java.lang.Integer">
        SELECT  COUNT(1)
        FROM
        (
    SELECT B.FOLIO,
       B.NO_OFICIO,
       B.ID_ASUNTO_REF,
       B.INIDASUNTO,
       B.ASUNTO,
        CASE
           WHEN (SELECT ESTATUS_DET
                   FROM (SELECT AD3.ID_ASUNTO, MAX(AD3.ESTATUS) AS ESTATUS_DET
                           FROM ASUNTO_DETALLE AD3
                          WHERE (AD3.ID_EMPLEADO_REMI IN(SELECT ID_EMPLEADO FROM EMPLEADO WHERE
                                <isNotEmpty prepend="" property="ids_area">
                                    <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                        ID_AREA =#ids_area[]#
                                    </iterate>
                                </isNotEmpty>
                                 ) OR
                                 AD3.ID_EMPLEADO_DEST IN(SELECT ID_EMPLEADO FROM EMPLEADO WHERE
                                <isNotEmpty prepend="" property="ids_area">
                                    <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                        ID_AREA =#ids_area[]#
                                    </iterate>
                                </isNotEmpty>
                                 ) OR
                                 AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL) OR
                                 AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL))
                          GROUP BY AD3.ID_ASUNTO) AD_EST
                  WHERE AD_EST.ID_ASUNTO = B.INIDASUNTO) = 0 AND B.ESTATUS =2 THEN 1
            WHEN (SELECT ESTATUS_DET
                    FROM (SELECT AD3.ID_ASUNTO, MAX(AD3.ESTATUS) AS ESTATUS_DET
                            FROM ASUNTO_DETALLE AD3
                           WHERE (AD3.ID_EMPLEADO_REMI IN(SELECT ID_EMPLEADO FROM EMPLEADO WHERE
                                <isNotEmpty prepend="" property="ids_area">
                                    <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                        ID_AREA =#ids_area[]#
                                    </iterate>
                                </isNotEmpty>
                                  ) OR
                                  AD3.ID_EMPLEADO_DEST IN(SELECT ID_EMPLEADO FROM EMPLEADO WHERE
                                <isNotEmpty prepend="" property="ids_area">
                                    <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                        ID_AREA =#ids_area[]#
                                    </iterate>
                                </isNotEmpty>
                                  ) OR
                                  AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL) OR
                                  AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL))
                           GROUP BY AD3.ID_ASUNTO) AD_EST
                   WHERE AD_EST.ID_ASUNTO = B.INIDASUNTO) = 1 AND B.ESTATUS =2 THEN 1
            ELSE B.ESTATUS
       END AS ESTATUS,
       B.ID_AREA,
       B.AREA,
       B.NOMBREREMITENTE,
       B.PATERNOREMITENTE,
       B.MATERNOREMITENTE,
       B.NOMBREDESTINATARIO,
       B.PATERNODESTINATARIO,
       B.MATERNODESTINATARIO,
       ROWNUM,
       B.ATENCIONP,
       ID
       FROM
        (
        SELECT  INASUNTO.FOLIO||'-'||INASUNTO.CONTADOR_FOLIO AS FOLIO, INASUNTO.NO_OFICIO, INASUNTO.ID_ASUNTO_REF, INASUNTO.ID_ASUNTO INIDASUNTO,
        INASUNTO.ASUNTO, INASUNTO.ESTATUS, AREA.ID_AREA, AREA.AREA, REMITENTE.NOMBRE NOMBREREMITENTE, REMITENTE.PATERNO PATERNOREMITENTE,
        REMITENTE.MATERNO MATERNOREMITENTE, DESTINATARIO.NOMBRE NOMBREDESTINATARIO, DESTINATARIO.PATERNO PATERNODESTINATARIO,
        DESTINATARIO.MATERNO MATERNODESTINATARIO, AT.COMENTARIO ATENCIONP, 0 AS ID
        FROM ASUNTO INASUNTO
        INNER JOIN EMPLEADO REMITENTE ON INASUNTO.ID_EMPLEADO_REMI = REMITENTE.ID_EMPLEADO
        INNER JOIN EMPLEADO DESTINATARIO ON INASUNTO.ID_EMPLEADO_DEST = DESTINATARIO.ID_EMPLEADO
        LEFT JOIN ASUNTO_ATENCION_PARCIAL AT ON INASUNTO.ID_ASUNTO = AT.ID_ASUNTO
        INNER JOIN AREA ON REMITENTE.ID_AREA = AREA.ID_AREA WHERE

        <isNotEmpty prepend="" property="ids_area">
            <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                AREA.ID_AREA =#ids_area[]#
            </iterate>
        </isNotEmpty>

        <isNotEmpty prepend="" property="id_area_dest">
            <isGreaterThan prepend="AND" property="id_area_dest" compareValue="-1">
                DESTINATARIO.ID_AREA =#id_area_dest#
            </isGreaterThan>
        </isNotEmpty>

        <isNotNull prepend="" property="fh_registroIni">
            <isNotNull prepend="AND" property="fh_registroFin">
		  INASUNTO.FH_OFICIO BETWEEN #fh_registroIni# AND #fh_registroFin#
            </isNotNull>
        </isNotNull>
	<isNotNull prepend="" property="id_estatus">
            <isEqual prepend="AND" property="id_estatus" compareValue="0">
                        CASE
                                    WHEN (SELECT ESTATUS_DET
                                            FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL))
                                                   GROUP BY AD3.ID_ASUNTO
                                                ) AD_EST
                                           WHERE AD_EST.ID_ASUNTO = INASUNTO.ID_ASUNTO) = 0 AND INASUNTO.ESTATUS = 2
                                            THEN 1
                                     WHEN (SELECT ESTATUS_DET
                                             FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL ))
                                                  GROUP BY AD3.ID_ASUNTO
                                                 ) AD_EST
                                            WHERE AD_EST.ID_ASUNTO = INASUNTO.ID_ASUNTO) = 1 AND INASUNTO.ESTATUS = 2
                                            THEN 1
                                    ELSE INASUNTO.ESTATUS
                                  END in(0,1)
                      AND AT.COMENTARIO is not null
            </isEqual>
            <isEqual prepend="AND" property="id_estatus" compareValue="1">
                        CASE
                                    WHEN (SELECT ESTATUS_DET
                                            FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL))
                                                   GROUP BY AD3.ID_ASUNTO
                                                ) AD_EST
                                           WHERE AD_EST.ID_ASUNTO = INASUNTO.ID_ASUNTO) = 0 AND INASUNTO.ESTATUS = 2
                                            THEN 1
                                     WHEN (SELECT ESTATUS_DET
                                             FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL ))
                                                  GROUP BY AD3.ID_ASUNTO
                                                 ) AD_EST
                                            WHERE AD_EST.ID_ASUNTO = INASUNTO.ID_ASUNTO) = 1 AND INASUNTO.ESTATUS = 2
                                            THEN 1
                                    ELSE INASUNTO.ESTATUS
                                  END = 1
                      AND AT.COMENTARIO IS NULL
            </isEqual>
            <isEqual prepend="AND" property="id_estatus" compareValue="2">
                        CASE
                                    WHEN (SELECT ESTATUS_DET
                                            FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL))
                                                   GROUP BY AD3.ID_ASUNTO
                                                ) AD_EST
                                           WHERE AD_EST.ID_ASUNTO = INASUNTO.ID_ASUNTO) = 0 AND INASUNTO.ESTATUS = 2
                                            THEN 1
                                     WHEN (SELECT ESTATUS_DET
                                             FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL ))
                                                  GROUP BY AD3.ID_ASUNTO
                                                 ) AD_EST
                                            WHERE AD_EST.ID_ASUNTO = INASUNTO.ID_ASUNTO) = 1 AND INASUNTO.ESTATUS = 2
                                            THEN 1
                                    ELSE INASUNTO.ESTATUS
                                  END = 2
            </isEqual>
            <isEqual prepend="AND" property="id_estatus" compareValue="3">
                        CASE
                                    WHEN (SELECT ESTATUS_DET
                                            FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL))
                                                   GROUP BY AD3.ID_ASUNTO
                                                ) AD_EST
                                           WHERE AD_EST.ID_ASUNTO = INASUNTO.ID_ASUNTO) = 0 AND INASUNTO.ESTATUS = 2
                                            THEN 1
                                     WHEN (SELECT ESTATUS_DET
                                             FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL ))
                                                  GROUP BY AD3.ID_ASUNTO
                                                 ) AD_EST
                                            WHERE AD_EST.ID_ASUNTO = INASUNTO.ID_ASUNTO) = 1 AND INASUNTO.ESTATUS = 2
                                            THEN 1
                                    ELSE INASUNTO.ESTATUS
                                  END = 3
            </isEqual>
            <isEqual prepend="AND" property="id_estatus" compareValue="-1">
                  ((INASUNTO.ESTATUS in (0,1) AND AT.COMENTARIO is not null) OR
                  (INASUNTO.ESTATUS = 1 AND AT.COMENTARIO is null) OR
                  (INASUNTO.ESTATUS = 2) OR
                  (INASUNTO.ESTATUS = 3))
            </isEqual>
        </isNotNull>
        <isNotNull prepend="" property="id_tema">
            <isNotEqual prepend="AND" property="id_tema" compareValue="-1">
                  INASUNTO.ID_TEMA = #id_tema#
            </isNotEqual>
        </isNotNull>
        <isNotNull prepend="" property="id_expediente">
            <isNotEqual prepend="AND" property="id_expediente" compareValue="-1">
                  INASUNTO.ID_EXPEDIENTE = #id_expediente#
            </isNotEqual>
        </isNotNull>
 UNION ALL
  (SELECT A.FOLIO||'-'||A.CONTADOR_FOLIO AS FOLIO, A.NO_OFICIO, A.ID_ASUNTO_REF, AD.ID_ASUNTO INIDASUNTO,
       A.ASUNTO, A.ESTATUS, AREA.ID_AREA, AREA.AREA, REMITENTE.NOMBRE NOMBREREMITENTE, REMITENTE.PATERNO PATERNOREMITENTE,
       REMITENTE.MATERNO MATERNOREMITENTE, DESTINATARIO.NOMBRE NOMBREDESTINATARIO, DESTINATARIO.PATERNO PATERNODESTINATARIO,
       DESTINATARIO.MATERNO MATERNODESTINATARIO, AT.COMENTARIO ATENCIONP, AD.ID_ASUNTO_DETALLE AS ID
   FROM ASUNTO_DETALLE AD
 INNER JOIN ASUNTO A ON AD.ID_ASUNTO = A.ID_ASUNTO
 INNER JOIN EMPLEADO REMITENTE ON AD.ID_EMPLEADO_REMI = REMITENTE.ID_EMPLEADO
 INNER JOIN EMPLEADO DESTINATARIO ON AD.ID_EMPLEADO_DEST = DESTINATARIO.ID_EMPLEADO
  LEFT JOIN ASUNTO_ATENCION_PARCIAL AT ON AD.ID_ASUNTO = AT.ID_ASUNTO
 INNER JOIN AREA ON REMITENTE.ID_AREA = AREA.ID_AREA
 WHERE AD.ID_EMPLEADO_REMI IN(SELECT ID_EMPLEADO FROM EMPLEADO WHERE
        <isNotEmpty prepend="" property="ids_area">
            <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                ID_AREA =#ids_area[]#
            </iterate>
        </isNotEmpty>
 )
   AND AD.ID_ASUNTO NOT IN (SELECT DISTINCT (A.ID_ASUNTO)
                              FROM ASUNTO A
                             INNER JOIN EMPLEADO REMITENTE ON A.ID_EMPLEADO_REMI = REMITENTE.ID_EMPLEADO
                              LEFT JOIN ASUNTO_ATENCION_PARCIAL AT ON A.ID_ASUNTO = AT.ID_ASUNTO
                             INNER JOIN AREA ON REMITENTE.ID_AREA = AREA.ID_AREA
                             WHERE
        <isNotEmpty prepend="" property="ids_area">
            <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                AREA.ID_AREA =#ids_area[]#
            </iterate>
        </isNotEmpty>
        <isNotNull prepend="" property="id_estatus">
            <isEqual prepend="AND" property="id_estatus" compareValue="0">
                        CASE
                                    WHEN (SELECT ESTATUS_DET
                                            FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL))
                                                   GROUP BY AD3.ID_ASUNTO
                                                ) AD_EST
                                           WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 0 AND A.ESTATUS = 2
                                            THEN 1
                                     WHEN (SELECT ESTATUS_DET
                                             FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL ))
                                                  GROUP BY AD3.ID_ASUNTO
                                                 ) AD_EST
                                            WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 1 AND A.ESTATUS = 2
                                    THEN 1
                                    ELSE A.ESTATUS
                                  END in(0,1)
                      AND AT.COMENTARIO IS NOT NULL
            </isEqual>
            <isEqual prepend="AND" property="id_estatus" compareValue="1">
                        CASE
                                    WHEN (SELECT ESTATUS_DET
                                            FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL))
                                                   GROUP BY AD3.ID_ASUNTO
                                                ) AD_EST
                                           WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 0 AND A.ESTATUS = 2
                                            THEN 1
                                     WHEN (SELECT ESTATUS_DET
                                             FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL ))
                                                  GROUP BY AD3.ID_ASUNTO
                                                 ) AD_EST
                                            WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 1 AND A.ESTATUS = 2
                                    THEN 1
                                    ELSE A.ESTATUS
                                  END = 1
                      AND AT.COMENTARIO IS NULL
            </isEqual>
            <isEqual prepend="AND" property="id_estatus" compareValue="2">
                        CASE
                                    WHEN (SELECT ESTATUS_DET
                                            FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL))
                                                   GROUP BY AD3.ID_ASUNTO
                                                ) AD_EST
                                           WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 0 AND A.ESTATUS = 2
                                            THEN 1
                                     WHEN (SELECT ESTATUS_DET
                                             FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL ))
                                                  GROUP BY AD3.ID_ASUNTO
                                                 ) AD_EST
                                            WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 1 AND A.ESTATUS = 2
                                    THEN 1
                                    ELSE A.ESTATUS
                                  END = 2
            </isEqual>
            <isEqual prepend="AND" property="id_estatus" compareValue="3">
                        CASE
                                    WHEN (SELECT ESTATUS_DET
                                            FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL))
                                                   GROUP BY AD3.ID_ASUNTO
                                                ) AD_EST
                                           WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 0 AND A.ESTATUS = 2
                                            THEN 1
                                     WHEN (SELECT ESTATUS_DET
                                             FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL ))
                                                  GROUP BY AD3.ID_ASUNTO
                                                 ) AD_EST
                                            WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 1 AND A.ESTATUS = 2
                                    THEN 1
                                    ELSE A.ESTATUS
                                  END = 3
            </isEqual>
            <isEqual prepend="AND" property="id_estatus" compareValue="-1">
                  ((A.ESTATUS in (0,1) AND AT.COMENTARIO is not null) OR
                  (A.ESTATUS = 1 AND AT.COMENTARIO is null) OR
                  (A.ESTATUS = 2) OR
                  (A.ESTATUS = 3))
            </isEqual>
        </isNotNull>
        <isNotEmpty prepend="" property="id_area_dest">
            <isGreaterThan prepend="AND" property="id_area_dest" compareValue="-1">
                DESTINATARIO.ID_AREA =#id_area_dest#
            </isGreaterThan>
        </isNotEmpty>

        <isNotNull prepend="" property="fh_registroIni">
            <isNotNull prepend="AND" property="fh_registroFin">
		  A.FH_OFICIO BETWEEN #fh_registroIni# AND #fh_registroFin#
            </isNotNull>
        </isNotNull>
        <isNotNull prepend="" property="id_tema">
            <isNotEqual prepend="AND" property="id_tema" compareValue="-1">
                  A.ID_TEMA = #id_tema#
            </isNotEqual>
        </isNotNull>
        <isNotNull prepend="" property="id_expediente">
            <isNotEqual prepend="AND" property="id_expediente" compareValue="-1">
                  A.ID_EXPEDIENTE = #id_expediente#
            </isNotEqual>
        </isNotNull>

							   )
        <isNotNull prepend="" property="fh_registroIni">
            <isNotNull prepend="AND" property="fh_registroFin">
		  A.FH_OFICIO BETWEEN #fh_registroIni# AND #fh_registroFin#
            </isNotNull>
        </isNotNull>
        <isNotEmpty prepend="" property="id_area_dest">
            <isGreaterThan prepend="AND" property="id_area_dest" compareValue="-1">
                DESTINATARIO.ID_AREA =#id_area_dest#
            </isGreaterThan>
        </isNotEmpty>

        <isNotNull prepend="" property="id_estatus">
            <isEqual prepend="AND" property="id_estatus" compareValue="0">
                        CASE
                                    WHEN (SELECT ESTATUS_DET
                                            FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL))
                                                   GROUP BY AD3.ID_ASUNTO
                                                ) AD_EST
                                           WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 0 AND A.ESTATUS = 2
                                            THEN 1
                                     WHEN (SELECT ESTATUS_DET
                                             FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL ))
                                                  GROUP BY AD3.ID_ASUNTO
                                                 ) AD_EST
                                            WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 1 AND A.ESTATUS = 2
                                    THEN 1
                                    ELSE A.ESTATUS
                                  END in (0,1)
                      AND AT.COMENTARIO IS NOT NULL
            </isEqual>
            <isEqual prepend="AND" property="id_estatus" compareValue="1">
                        CASE
                                    WHEN (SELECT ESTATUS_DET
                                            FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL))
                                                   GROUP BY AD3.ID_ASUNTO
                                                ) AD_EST
                                           WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 0 AND A.ESTATUS = 2
                                            THEN 1
                                     WHEN (SELECT ESTATUS_DET
                                             FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL ))
                                                  GROUP BY AD3.ID_ASUNTO
                                                 ) AD_EST
                                            WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 1 AND A.ESTATUS = 2
                                    THEN 1
                                    ELSE A.ESTATUS
                                  END = 1
                      AND AT.COMENTARIO IS NULL
            </isEqual>
            <isEqual prepend="AND" property="id_estatus" compareValue="2">
                        CASE
                                    WHEN (SELECT ESTATUS_DET
                                            FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL))
                                                   GROUP BY AD3.ID_ASUNTO
                                                ) AD_EST
                                           WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 0 AND A.ESTATUS = 2
                                            THEN 1
                                     WHEN (SELECT ESTATUS_DET
                                             FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL ))
                                                  GROUP BY AD3.ID_ASUNTO
                                                 ) AD_EST
                                            WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 1 AND A.ESTATUS = 2
                                    THEN 1
                                    ELSE A.ESTATUS
                                  END = 2
            </isEqual>
            <isEqual prepend="AND" property="id_estatus" compareValue="3">
                        CASE
                                    WHEN (SELECT ESTATUS_DET
                                            FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL))
                                                   GROUP BY AD3.ID_ASUNTO
                                                ) AD_EST
                                           WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 0 AND A.ESTATUS = 2
                                            THEN 1
                                     WHEN (SELECT ESTATUS_DET
                                             FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL ))
                                                  GROUP BY AD3.ID_ASUNTO
                                                 ) AD_EST
                                            WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 1 AND A.ESTATUS = 2
                                    THEN 1
                                    ELSE A.ESTATUS
                                  END = 3
            </isEqual>
            <isEqual prepend="AND" property="id_estatus" compareValue="-1">
                  ((A.ESTATUS in (0,1) AND AT.COMENTARIO is not null) OR
                  (A.ESTATUS = 1 AND AT.COMENTARIO is null) OR
                  (A.ESTATUS = 2) OR
                  (A.ESTATUS = 3))
            </isEqual>
        </isNotNull>
        <isNotNull prepend="" property="id_tema">
            <isNotEqual prepend="AND" property="id_tema" compareValue="-1">
                  A.ID_TEMA = #id_tema#
            </isNotEqual>
        </isNotNull>
        <isNotNull prepend="" property="id_expediente">
            <isNotEqual prepend="AND" property="id_expediente" compareValue="-1">
                  A.ID_EXPEDIENTE = #id_expediente#
            </isNotEqual>
        </isNotNull>
       )) B
      WHERE (B.ID IN (SELECT MAX FROM (SELECT MAX(ID_ASUNTO_DETALLE) AS MAX, ID_ASUNTO
                                        FROM  ASUNTO_DETALLE AD3
                                       WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>

											))
                                          OR  AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
											))
                                          OR  AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                          OR  AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL))
                                       GROUP BY ID_ASUNTO)) OR B.ID = 0)
                                       )
    </select>    
    
    
    <resultMap id="resulMapDetalle" class="mx.gob.economia.scg.model.Reporte">
        <result property="empleado.nombre" column="NOMBREREMITENTE"/>
        <result property="empleado.paterno" column="PATERNOREMITENTE"/>
        <result property="empleado.materno" column="MATERNOREMITENTE"/>
        <result property="destinatario.nombre" column="NOMBREDESTINATARIO"/>
        <result property="destinatario.paterno" column="PATERNODESTINATARIO"/>
        <result property="destinatario.materno" column="MATERNODESTINATARIO"/>
        <result property="folio" column="FOLIO"/>
        <result property="noOficio" column="NO_OFICIO"/>
        <result property="idAsuntoRef" column="ID_ASUNTO_REF"/>
        <result property="estatus" column="ESTATUS"/>
        <result property="atencionParcial" column="ATENCIONP"/>
        <result property="rownum" column="rownum"/>
    </resultMap>    
    <select id="listaReporteGeneralDetalle" resultMap="resulMapDetalle" parameterClass="mx.gob.economia.scg.model.CriterioReporte">
    SELECT * FROM (
    SELECT vista.*, rownum r FROM(

    SELECT B.FOLIO,
       B.NO_OFICIO,
       B.ID_ASUNTO_REF,
       B.INIDASUNTO,
       B.ASUNTO,
        CASE
           WHEN (SELECT ESTATUS_DET
                   FROM (SELECT AD3.ID_ASUNTO, MAX(AD3.ESTATUS) AS ESTATUS_DET
                           FROM ASUNTO_DETALLE AD3
                          WHERE (AD3.ID_EMPLEADO_REMI IN(SELECT ID_EMPLEADO FROM EMPLEADO WHERE
                                <isNotEmpty prepend="" property="ids_area">
                                    <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                        ID_AREA =#ids_area[]#
                                    </iterate>
                                </isNotEmpty>
                                 ) OR
                                 AD3.ID_EMPLEADO_DEST IN(SELECT ID_EMPLEADO FROM EMPLEADO WHERE
                                <isNotEmpty prepend="" property="ids_area">
                                    <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                        ID_AREA =#ids_area[]#
                                    </iterate>
                                </isNotEmpty>
                                 ) OR
                                 AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL) OR
                                 AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL))
                          GROUP BY AD3.ID_ASUNTO) AD_EST
                  WHERE AD_EST.ID_ASUNTO = B.INIDASUNTO) = 0 AND B.ESTATUS =2 THEN 1
            WHEN (SELECT ESTATUS_DET
                    FROM (SELECT AD3.ID_ASUNTO, MAX(AD3.ESTATUS) AS ESTATUS_DET
                            FROM ASUNTO_DETALLE AD3
                           WHERE (AD3.ID_EMPLEADO_REMI IN(SELECT ID_EMPLEADO FROM EMPLEADO WHERE
                                <isNotEmpty prepend="" property="ids_area">
                                    <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                        ID_AREA =#ids_area[]#
                                    </iterate>
                                </isNotEmpty>
                                  ) OR
                                  AD3.ID_EMPLEADO_DEST IN(SELECT ID_EMPLEADO FROM EMPLEADO WHERE
                                <isNotEmpty prepend="" property="ids_area">
                                    <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                        ID_AREA =#ids_area[]#
                                    </iterate>
                                </isNotEmpty>
                                  ) OR
                                  AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL) OR
                                  AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL))
                           GROUP BY AD3.ID_ASUNTO) AD_EST
                   WHERE AD_EST.ID_ASUNTO = B.INIDASUNTO) = 1 AND B.ESTATUS =2 THEN 1
            ELSE B.ESTATUS
       END AS ESTATUS,
       B.ID_AREA,
       B.AREA,
       B.NOMBREREMITENTE,
       B.PATERNOREMITENTE,
       B.MATERNOREMITENTE,
       B.NOMBREDESTINATARIO,
       B.PATERNODESTINATARIO,
       B.MATERNODESTINATARIO,
       ROWNUM,
       B.ATENCIONP,
       ID
       FROM
        (
        SELECT  INASUNTO.FOLIO||'-'||INASUNTO.CONTADOR_FOLIO AS FOLIO, INASUNTO.NO_OFICIO, INASUNTO.ID_ASUNTO_REF, INASUNTO.ID_ASUNTO INIDASUNTO,
        INASUNTO.ASUNTO, INASUNTO.ESTATUS, AREA.ID_AREA, AREA.AREA, REMITENTE.NOMBRE NOMBREREMITENTE, REMITENTE.PATERNO PATERNOREMITENTE,
        REMITENTE.MATERNO MATERNOREMITENTE, DESTINATARIO.NOMBRE NOMBREDESTINATARIO, DESTINATARIO.PATERNO PATERNODESTINATARIO,
        DESTINATARIO.MATERNO MATERNODESTINATARIO, AT.COMENTARIO ATENCIONP, 0 AS ID
        FROM ASUNTO INASUNTO
        INNER JOIN EMPLEADO REMITENTE ON INASUNTO.ID_EMPLEADO_REMI = REMITENTE.ID_EMPLEADO
        INNER JOIN EMPLEADO DESTINATARIO ON INASUNTO.ID_EMPLEADO_DEST = DESTINATARIO.ID_EMPLEADO
        LEFT JOIN ASUNTO_ATENCION_PARCIAL AT ON INASUNTO.ID_ASUNTO = AT.ID_ASUNTO
        INNER JOIN AREA ON REMITENTE.ID_AREA = AREA.ID_AREA WHERE

        <isNotEmpty prepend="" property="ids_area">
            <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                AREA.ID_AREA =#ids_area[]#
            </iterate>
        </isNotEmpty>

        <isNotEmpty prepend="" property="id_area_dest">
            <isGreaterThan prepend="AND" property="id_area_dest" compareValue="-1">
                DESTINATARIO.ID_AREA =#id_area_dest#
            </isGreaterThan>
        </isNotEmpty>

        <isNotNull prepend="" property="fh_registroIni">
            <isNotNull prepend="AND" property="fh_registroFin">
		  INASUNTO.FH_OFICIO BETWEEN #fh_registroIni# AND #fh_registroFin#
            </isNotNull>
        </isNotNull>
	<isNotNull prepend="" property="id_estatus">
            <isEqual prepend="AND" property="id_estatus" compareValue="0">
                        CASE
                                    WHEN (SELECT ESTATUS_DET
                                            FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL))
                                                   GROUP BY AD3.ID_ASUNTO
                                                ) AD_EST
                                           WHERE AD_EST.ID_ASUNTO = INASUNTO.ID_ASUNTO) = 0 AND INASUNTO.ESTATUS = 2
                                            THEN 1
                                     WHEN (SELECT ESTATUS_DET
                                             FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL ))
                                                  GROUP BY AD3.ID_ASUNTO
                                                 ) AD_EST
                                            WHERE AD_EST.ID_ASUNTO = INASUNTO.ID_ASUNTO) = 1 AND INASUNTO.ESTATUS = 2
                                            THEN 1
                                    ELSE INASUNTO.ESTATUS
                                  END in(0,1)
                      AND AT.COMENTARIO is not null
            </isEqual>
            <isEqual prepend="AND" property="id_estatus" compareValue="1">
                        CASE
                                    WHEN (SELECT ESTATUS_DET
                                            FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL))
                                                   GROUP BY AD3.ID_ASUNTO
                                                ) AD_EST
                                           WHERE AD_EST.ID_ASUNTO = INASUNTO.ID_ASUNTO) = 0 AND INASUNTO.ESTATUS = 2
                                            THEN 1
                                     WHEN (SELECT ESTATUS_DET
                                             FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL ))
                                                  GROUP BY AD3.ID_ASUNTO
                                                 ) AD_EST
                                            WHERE AD_EST.ID_ASUNTO = INASUNTO.ID_ASUNTO) = 1 AND INASUNTO.ESTATUS = 2
                                            THEN 1
                                    ELSE INASUNTO.ESTATUS
                                  END = 1
                      AND AT.COMENTARIO IS NULL
            </isEqual>
            <isEqual prepend="AND" property="id_estatus" compareValue="2">
                        CASE
                                    WHEN (SELECT ESTATUS_DET
                                            FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL))
                                                   GROUP BY AD3.ID_ASUNTO
                                                ) AD_EST
                                           WHERE AD_EST.ID_ASUNTO = INASUNTO.ID_ASUNTO) = 0 AND INASUNTO.ESTATUS = 2
                                            THEN 1
                                     WHEN (SELECT ESTATUS_DET
                                             FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL ))
                                                  GROUP BY AD3.ID_ASUNTO
                                                 ) AD_EST
                                            WHERE AD_EST.ID_ASUNTO = INASUNTO.ID_ASUNTO) = 1 AND INASUNTO.ESTATUS = 2
                                            THEN 1
                                    ELSE INASUNTO.ESTATUS
                                  END = 2
            </isEqual>
            <isEqual prepend="AND" property="id_estatus" compareValue="3">
                        CASE
                                    WHEN (SELECT ESTATUS_DET
                                            FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL))
                                                   GROUP BY AD3.ID_ASUNTO
                                                ) AD_EST
                                           WHERE AD_EST.ID_ASUNTO = INASUNTO.ID_ASUNTO) = 0 AND INASUNTO.ESTATUS = 2
                                            THEN 1
                                     WHEN (SELECT ESTATUS_DET
                                             FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL ))
                                                  GROUP BY AD3.ID_ASUNTO
                                                 ) AD_EST
                                            WHERE AD_EST.ID_ASUNTO = INASUNTO.ID_ASUNTO) = 1 AND INASUNTO.ESTATUS = 2
                                            THEN 1
                                    ELSE INASUNTO.ESTATUS
                                  END = 3
            </isEqual>
            <isEqual prepend="AND" property="id_estatus" compareValue="-1">
                  ((INASUNTO.ESTATUS in (0,1) AND AT.COMENTARIO is not null) OR
                  (INASUNTO.ESTATUS = 1 AND AT.COMENTARIO is null) OR
                  (INASUNTO.ESTATUS = 2) OR
                  (INASUNTO.ESTATUS = 3))
            </isEqual>
        </isNotNull>
        <isNotNull prepend="" property="id_tema">
            <isNotEqual prepend="AND" property="id_tema" compareValue="-1">
                  INASUNTO.ID_TEMA = #id_tema#
            </isNotEqual>
        </isNotNull>
        <isNotNull prepend="" property="id_expediente">
            <isNotEqual prepend="AND" property="id_expediente" compareValue="-1">
                  INASUNTO.ID_EXPEDIENTE = #id_expediente#
            </isNotEqual>
        </isNotNull>
 UNION ALL
  (SELECT A.FOLIO||'-'||A.CONTADOR_FOLIO AS FOLIO, A.NO_OFICIO, A.ID_ASUNTO_REF, AD.ID_ASUNTO INIDASUNTO,
       A.ASUNTO, A.ESTATUS, AREA.ID_AREA, AREA.AREA, REMITENTE.NOMBRE NOMBREREMITENTE, REMITENTE.PATERNO PATERNOREMITENTE,
       REMITENTE.MATERNO MATERNOREMITENTE, DESTINATARIO.NOMBRE NOMBREDESTINATARIO, DESTINATARIO.PATERNO PATERNODESTINATARIO,
       DESTINATARIO.MATERNO MATERNODESTINATARIO, AT.COMENTARIO ATENCIONP, AD.ID_ASUNTO_DETALLE AS ID
   FROM ASUNTO_DETALLE AD
 INNER JOIN ASUNTO A ON AD.ID_ASUNTO = A.ID_ASUNTO
 INNER JOIN EMPLEADO REMITENTE ON AD.ID_EMPLEADO_REMI = REMITENTE.ID_EMPLEADO
 INNER JOIN EMPLEADO DESTINATARIO ON AD.ID_EMPLEADO_DEST = DESTINATARIO.ID_EMPLEADO
  LEFT JOIN ASUNTO_ATENCION_PARCIAL AT ON AD.ID_ASUNTO = AT.ID_ASUNTO
 INNER JOIN AREA ON REMITENTE.ID_AREA = AREA.ID_AREA
 WHERE AD.ID_EMPLEADO_REMI IN(SELECT ID_EMPLEADO FROM EMPLEADO WHERE
        <isNotEmpty prepend="" property="ids_area">
            <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                ID_AREA =#ids_area[]#
            </iterate>
        </isNotEmpty>
 )
   AND AD.ID_ASUNTO NOT IN (SELECT DISTINCT (A.ID_ASUNTO)
                              FROM ASUNTO A
                             INNER JOIN EMPLEADO REMITENTE ON A.ID_EMPLEADO_REMI = REMITENTE.ID_EMPLEADO
                              LEFT JOIN ASUNTO_ATENCION_PARCIAL AT ON A.ID_ASUNTO = AT.ID_ASUNTO
                             INNER JOIN AREA ON REMITENTE.ID_AREA = AREA.ID_AREA
                             WHERE
        <isNotEmpty prepend="" property="ids_area">
            <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                AREA.ID_AREA =#ids_area[]#
            </iterate>
        </isNotEmpty>
        <isNotNull prepend="" property="id_estatus">
            <isEqual prepend="AND" property="id_estatus" compareValue="0">
                        CASE
                                    WHEN (SELECT ESTATUS_DET
                                            FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL))
                                                   GROUP BY AD3.ID_ASUNTO
                                                ) AD_EST
                                           WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 0 AND A.ESTATUS = 2
                                            THEN 1
                                     WHEN (SELECT ESTATUS_DET
                                             FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL ))
                                                  GROUP BY AD3.ID_ASUNTO
                                                 ) AD_EST
                                            WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 1 AND A.ESTATUS = 2
                                    THEN 1
                                    ELSE A.ESTATUS
                                  END in(0,1)
                      AND AT.COMENTARIO IS NOT NULL
            </isEqual>
            <isEqual prepend="AND" property="id_estatus" compareValue="1">
                        CASE
                                    WHEN (SELECT ESTATUS_DET
                                            FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL))
                                                   GROUP BY AD3.ID_ASUNTO
                                                ) AD_EST
                                           WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 0 AND A.ESTATUS = 2
                                            THEN 1
                                     WHEN (SELECT ESTATUS_DET
                                             FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL ))
                                                  GROUP BY AD3.ID_ASUNTO
                                                 ) AD_EST
                                            WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 1 AND A.ESTATUS = 2
                                    THEN 1
                                    ELSE A.ESTATUS
                                  END = 1
                      AND AT.COMENTARIO IS NULL
            </isEqual>
            <isEqual prepend="AND" property="id_estatus" compareValue="2">
                        CASE
                                    WHEN (SELECT ESTATUS_DET
                                            FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL))
                                                   GROUP BY AD3.ID_ASUNTO
                                                ) AD_EST
                                           WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 0 AND A.ESTATUS = 2
                                            THEN 1
                                     WHEN (SELECT ESTATUS_DET
                                             FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL ))
                                                  GROUP BY AD3.ID_ASUNTO
                                                 ) AD_EST
                                            WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 1 AND A.ESTATUS = 2
                                    THEN 1
                                    ELSE A.ESTATUS
                                  END = 2
            </isEqual>
            <isEqual prepend="AND" property="id_estatus" compareValue="3">
                        CASE
                                    WHEN (SELECT ESTATUS_DET
                                            FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL))
                                                   GROUP BY AD3.ID_ASUNTO
                                                ) AD_EST
                                           WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 0 AND A.ESTATUS = 2
                                            THEN 1
                                     WHEN (SELECT ESTATUS_DET
                                             FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL ))
                                                  GROUP BY AD3.ID_ASUNTO
                                                 ) AD_EST
                                            WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 1 AND A.ESTATUS = 2
                                    THEN 1
                                    ELSE A.ESTATUS
                                  END = 3
            </isEqual>
            <isEqual prepend="AND" property="id_estatus" compareValue="-1">
                  ((A.ESTATUS in (0,1) AND AT.COMENTARIO is not null) OR
                  (A.ESTATUS = 1 AND AT.COMENTARIO is null) OR
                  (A.ESTATUS = 2) OR
                  (A.ESTATUS = 3))
            </isEqual>
        </isNotNull>
        <isNotEmpty prepend="" property="id_area_dest">
            <isGreaterThan prepend="AND" property="id_area_dest" compareValue="-1">
                DESTINATARIO.ID_AREA =#id_area_dest#
            </isGreaterThan>
        </isNotEmpty>

        <isNotNull prepend="" property="fh_registroIni">
            <isNotNull prepend="AND" property="fh_registroFin">
		  A.FH_OFICIO BETWEEN #fh_registroIni# AND #fh_registroFin#
            </isNotNull>
        </isNotNull>
        <isNotNull prepend="" property="id_tema">
            <isNotEqual prepend="AND" property="id_tema" compareValue="-1">
                  A.ID_TEMA = #id_tema#
            </isNotEqual>
        </isNotNull>
        <isNotNull prepend="" property="id_expediente">
            <isNotEqual prepend="AND" property="id_expediente" compareValue="-1">
                  A.ID_EXPEDIENTE = #id_expediente#
            </isNotEqual>
        </isNotNull>

							   )
        <isNotNull prepend="" property="fh_registroIni">
            <isNotNull prepend="AND" property="fh_registroFin">
		  A.FH_OFICIO BETWEEN #fh_registroIni# AND #fh_registroFin#
            </isNotNull>
        </isNotNull>
        <isNotEmpty prepend="" property="id_area_dest">
            <isGreaterThan prepend="AND" property="id_area_dest" compareValue="-1">
                DESTINATARIO.ID_AREA =#id_area_dest#
            </isGreaterThan>
        </isNotEmpty>

        <isNotNull prepend="" property="id_estatus">
            <isEqual prepend="AND" property="id_estatus" compareValue="0">
                        CASE
                                    WHEN (SELECT ESTATUS_DET
                                            FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL))
                                                   GROUP BY AD3.ID_ASUNTO
                                                ) AD_EST
                                           WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 0 AND A.ESTATUS = 2
                                            THEN 1
                                     WHEN (SELECT ESTATUS_DET
                                             FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL ))
                                                  GROUP BY AD3.ID_ASUNTO
                                                 ) AD_EST
                                            WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 1 AND A.ESTATUS = 2
                                    THEN 1
                                    ELSE A.ESTATUS
                                  END in (0,1)
                      AND AT.COMENTARIO IS NOT NULL
            </isEqual>
            <isEqual prepend="AND" property="id_estatus" compareValue="1">
                        CASE
                                    WHEN (SELECT ESTATUS_DET
                                            FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL))
                                                   GROUP BY AD3.ID_ASUNTO
                                                ) AD_EST
                                           WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 0 AND A.ESTATUS = 2
                                            THEN 1
                                     WHEN (SELECT ESTATUS_DET
                                             FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL ))
                                                  GROUP BY AD3.ID_ASUNTO
                                                 ) AD_EST
                                            WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 1 AND A.ESTATUS = 2
                                    THEN 1
                                    ELSE A.ESTATUS
                                  END = 1
                      AND AT.COMENTARIO IS NULL
            </isEqual>
            <isEqual prepend="AND" property="id_estatus" compareValue="2">
                        CASE
                                    WHEN (SELECT ESTATUS_DET
                                            FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL))
                                                   GROUP BY AD3.ID_ASUNTO
                                                ) AD_EST
                                           WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 0 AND A.ESTATUS = 2
                                            THEN 1
                                     WHEN (SELECT ESTATUS_DET
                                             FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL ))
                                                  GROUP BY AD3.ID_ASUNTO
                                                 ) AD_EST
                                            WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 1 AND A.ESTATUS = 2
                                    THEN 1
                                    ELSE A.ESTATUS
                                  END = 2
            </isEqual>
            <isEqual prepend="AND" property="id_estatus" compareValue="3">
                        CASE
                                    WHEN (SELECT ESTATUS_DET
                                            FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL))
                                                   GROUP BY AD3.ID_ASUNTO
                                                ) AD_EST
                                           WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 0 AND A.ESTATUS = 2
                                            THEN 1
                                     WHEN (SELECT ESTATUS_DET
                                             FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL ))
                                                  GROUP BY AD3.ID_ASUNTO
                                                 ) AD_EST
                                            WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 1 AND A.ESTATUS = 2
                                    THEN 1
                                    ELSE A.ESTATUS
                                  END = 3
            </isEqual>
            <isEqual prepend="AND" property="id_estatus" compareValue="-1">
                  ((A.ESTATUS in (0,1) AND AT.COMENTARIO is not null) OR
                  (A.ESTATUS = 1 AND AT.COMENTARIO is null) OR
                  (A.ESTATUS = 2) OR
                  (A.ESTATUS = 3))
            </isEqual>
        </isNotNull>
        <isNotNull prepend="" property="id_tema">
            <isNotEqual prepend="AND" property="id_tema" compareValue="-1">
                  A.ID_TEMA = #id_tema#
            </isNotEqual>
        </isNotNull>
        <isNotNull prepend="" property="id_expediente">
            <isNotEqual prepend="AND" property="id_expediente" compareValue="-1">
                  A.ID_EXPEDIENTE = #id_expediente#
            </isNotEqual>
        </isNotNull>
       )) B
      WHERE (B.ID IN (SELECT MAX FROM (SELECT MAX(ID_ASUNTO_DETALLE) AS MAX, ID_ASUNTO
                                        FROM  ASUNTO_DETALLE AD3
                                       WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>

											))
                                          OR  AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
											))
                                          OR  AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                          OR  AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL))
                                       GROUP BY ID_ASUNTO)) OR B.ID = 0)
	   		) vista WHERE ROWNUM<![CDATA[ <= ]]>#paginador.maximo#
	    ) WHERE r<![CDATA[ >= ]]>#paginador.minimo#
    </select>
    <select id="getAllResultReporteDetalle" resultMap="resulMapDetalle" parameterClass="mx.gob.economia.scg.model.CriterioReporte">
    SELECT B.FOLIO,
       B.NO_OFICIO,
       B.ID_ASUNTO_REF,
       B.INIDASUNTO,
       B.ASUNTO,
        CASE
           WHEN (SELECT ESTATUS_DET
                   FROM (SELECT AD3.ID_ASUNTO, MAX(AD3.ESTATUS) AS ESTATUS_DET
                           FROM ASUNTO_DETALLE AD3
                          WHERE (AD3.ID_EMPLEADO_REMI IN(SELECT ID_EMPLEADO FROM EMPLEADO WHERE
                                <isNotEmpty prepend="" property="ids_area">
                                    <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                        ID_AREA =#ids_area[]#
                                    </iterate>
                                </isNotEmpty>
                                 ) OR
                                 AD3.ID_EMPLEADO_DEST IN(SELECT ID_EMPLEADO FROM EMPLEADO WHERE
                                <isNotEmpty prepend="" property="ids_area">
                                    <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                        ID_AREA =#ids_area[]#
                                    </iterate>
                                </isNotEmpty>
                                 ) OR
                                 AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL) OR
                                 AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL))
                          GROUP BY AD3.ID_ASUNTO) AD_EST
                  WHERE AD_EST.ID_ASUNTO = B.INIDASUNTO) = 0 AND B.ESTATUS =2 THEN 1
            WHEN (SELECT ESTATUS_DET
                    FROM (SELECT AD3.ID_ASUNTO, MAX(AD3.ESTATUS) AS ESTATUS_DET
                            FROM ASUNTO_DETALLE AD3
                           WHERE (AD3.ID_EMPLEADO_REMI IN(SELECT ID_EMPLEADO FROM EMPLEADO WHERE
                                <isNotEmpty prepend="" property="ids_area">
                                    <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                        ID_AREA =#ids_area[]#
                                    </iterate>
                                </isNotEmpty>
                                  ) OR
                                  AD3.ID_EMPLEADO_DEST IN(SELECT ID_EMPLEADO FROM EMPLEADO WHERE
                                <isNotEmpty prepend="" property="ids_area">
                                    <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                        ID_AREA =#ids_area[]#
                                    </iterate>
                                </isNotEmpty>
                                  ) OR
                                  AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL) OR
                                  AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL))
                           GROUP BY AD3.ID_ASUNTO) AD_EST
                   WHERE AD_EST.ID_ASUNTO = B.INIDASUNTO) = 1 AND B.ESTATUS =2 THEN 1
            ELSE B.ESTATUS
       END AS ESTATUS,
       B.ID_AREA,
       B.AREA,
       B.NOMBREREMITENTE,
       B.PATERNOREMITENTE,
       B.MATERNOREMITENTE,
       B.NOMBREDESTINATARIO,
       B.PATERNODESTINATARIO,
       B.MATERNODESTINATARIO,
       ROWNUM,
       B.ATENCIONP,
       ID
       FROM
        (
        SELECT  INASUNTO.FOLIO||'-'||INASUNTO.CONTADOR_FOLIO AS FOLIO, INASUNTO.NO_OFICIO, INASUNTO.ID_ASUNTO_REF, INASUNTO.ID_ASUNTO INIDASUNTO,
        INASUNTO.ASUNTO, INASUNTO.ESTATUS, AREA.ID_AREA, AREA.AREA, REMITENTE.NOMBRE NOMBREREMITENTE, REMITENTE.PATERNO PATERNOREMITENTE,
        REMITENTE.MATERNO MATERNOREMITENTE, DESTINATARIO.NOMBRE NOMBREDESTINATARIO, DESTINATARIO.PATERNO PATERNODESTINATARIO,
        DESTINATARIO.MATERNO MATERNODESTINATARIO, AT.COMENTARIO ATENCIONP, 0 AS ID
        FROM ASUNTO INASUNTO
        INNER JOIN EMPLEADO REMITENTE ON INASUNTO.ID_EMPLEADO_REMI = REMITENTE.ID_EMPLEADO
        INNER JOIN EMPLEADO DESTINATARIO ON INASUNTO.ID_EMPLEADO_DEST = DESTINATARIO.ID_EMPLEADO
        LEFT JOIN ASUNTO_ATENCION_PARCIAL AT ON INASUNTO.ID_ASUNTO = AT.ID_ASUNTO
        INNER JOIN AREA ON REMITENTE.ID_AREA = AREA.ID_AREA WHERE

        <isNotEmpty prepend="" property="ids_area">
            <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                AREA.ID_AREA =#ids_area[]#
            </iterate>
        </isNotEmpty>

        <isNotEmpty prepend="" property="id_area_dest">
            <isGreaterThan prepend="AND" property="id_area_dest" compareValue="-1">
                DESTINATARIO.ID_AREA =#id_area_dest#
            </isGreaterThan>
        </isNotEmpty>

        <isNotNull prepend="" property="fh_registroIni">
            <isNotNull prepend="AND" property="fh_registroFin">
		  INASUNTO.FH_OFICIO BETWEEN #fh_registroIni# AND #fh_registroFin#
            </isNotNull>
        </isNotNull>
	<isNotNull prepend="" property="id_estatus">
            <isEqual prepend="AND" property="id_estatus" compareValue="0">
                        CASE
                                    WHEN (SELECT ESTATUS_DET
                                            FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL))
                                                   GROUP BY AD3.ID_ASUNTO
                                                ) AD_EST
                                           WHERE AD_EST.ID_ASUNTO = INASUNTO.ID_ASUNTO) = 0 AND INASUNTO.ESTATUS = 2
                                            THEN 1
                                     WHEN (SELECT ESTATUS_DET
                                             FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL ))
                                                  GROUP BY AD3.ID_ASUNTO
                                                 ) AD_EST
                                            WHERE AD_EST.ID_ASUNTO = INASUNTO.ID_ASUNTO) = 1 AND INASUNTO.ESTATUS = 2
                                            THEN 1
                                    ELSE INASUNTO.ESTATUS
                                  END in(0,1)
                      AND AT.COMENTARIO is not null
            </isEqual>
            <isEqual prepend="AND" property="id_estatus" compareValue="1">
                        CASE
                                    WHEN (SELECT ESTATUS_DET
                                            FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL))
                                                   GROUP BY AD3.ID_ASUNTO
                                                ) AD_EST
                                           WHERE AD_EST.ID_ASUNTO = INASUNTO.ID_ASUNTO) = 0 AND INASUNTO.ESTATUS = 2
                                            THEN 1
                                     WHEN (SELECT ESTATUS_DET
                                             FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL ))
                                                  GROUP BY AD3.ID_ASUNTO
                                                 ) AD_EST
                                            WHERE AD_EST.ID_ASUNTO = INASUNTO.ID_ASUNTO) = 1 AND INASUNTO.ESTATUS = 2
                                            THEN 1
                                    ELSE INASUNTO.ESTATUS
                                  END = 1
                      AND AT.COMENTARIO IS NULL
            </isEqual>
            <isEqual prepend="AND" property="id_estatus" compareValue="2">
                        CASE
                                    WHEN (SELECT ESTATUS_DET
                                            FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL))
                                                   GROUP BY AD3.ID_ASUNTO
                                                ) AD_EST
                                           WHERE AD_EST.ID_ASUNTO = INASUNTO.ID_ASUNTO) = 0 AND INASUNTO.ESTATUS = 2
                                            THEN 1
                                     WHEN (SELECT ESTATUS_DET
                                             FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL ))
                                                  GROUP BY AD3.ID_ASUNTO
                                                 ) AD_EST
                                            WHERE AD_EST.ID_ASUNTO = INASUNTO.ID_ASUNTO) = 1 AND INASUNTO.ESTATUS = 2
                                            THEN 1
                                    ELSE INASUNTO.ESTATUS
                                  END = 2
            </isEqual>
            <isEqual prepend="AND" property="id_estatus" compareValue="3">
                        CASE
                                    WHEN (SELECT ESTATUS_DET
                                            FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL))
                                                   GROUP BY AD3.ID_ASUNTO
                                                ) AD_EST
                                           WHERE AD_EST.ID_ASUNTO = INASUNTO.ID_ASUNTO) = 0 AND INASUNTO.ESTATUS = 2
                                            THEN 1
                                     WHEN (SELECT ESTATUS_DET
                                             FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL ))
                                                  GROUP BY AD3.ID_ASUNTO
                                                 ) AD_EST
                                            WHERE AD_EST.ID_ASUNTO = INASUNTO.ID_ASUNTO) = 1 AND INASUNTO.ESTATUS = 2
                                            THEN 1
                                    ELSE INASUNTO.ESTATUS
                                  END = 3
            </isEqual>
            <isEqual prepend="AND" property="id_estatus" compareValue="-1">
                  ((INASUNTO.ESTATUS in (0,1) AND AT.COMENTARIO is not null) OR
                  (INASUNTO.ESTATUS = 1 AND AT.COMENTARIO is null) OR
                  (INASUNTO.ESTATUS = 2) OR
                  (INASUNTO.ESTATUS = 3))
            </isEqual>
        </isNotNull>
        <isNotNull prepend="" property="id_tema">
            <isNotEqual prepend="AND" property="id_tema" compareValue="-1">
                  INASUNTO.ID_TEMA = #id_tema#
            </isNotEqual>
        </isNotNull>
        <isNotNull prepend="" property="id_expediente">
            <isNotEqual prepend="AND" property="id_expediente" compareValue="-1">
                  INASUNTO.ID_EXPEDIENTE = #id_expediente#
            </isNotEqual>
        </isNotNull>
 UNION ALL
  (SELECT A.FOLIO||'-'||A.CONTADOR_FOLIO AS FOLIO, A.NO_OFICIO, A.ID_ASUNTO_REF, AD.ID_ASUNTO INIDASUNTO,
       A.ASUNTO, A.ESTATUS, AREA.ID_AREA, AREA.AREA, REMITENTE.NOMBRE NOMBREREMITENTE, REMITENTE.PATERNO PATERNOREMITENTE,
       REMITENTE.MATERNO MATERNOREMITENTE, DESTINATARIO.NOMBRE NOMBREDESTINATARIO, DESTINATARIO.PATERNO PATERNODESTINATARIO,
       DESTINATARIO.MATERNO MATERNODESTINATARIO, AT.COMENTARIO ATENCIONP, AD.ID_ASUNTO_DETALLE AS ID
   FROM ASUNTO_DETALLE AD
 INNER JOIN ASUNTO A ON AD.ID_ASUNTO = A.ID_ASUNTO
 INNER JOIN EMPLEADO REMITENTE ON AD.ID_EMPLEADO_REMI = REMITENTE.ID_EMPLEADO
 INNER JOIN EMPLEADO DESTINATARIO ON AD.ID_EMPLEADO_DEST = DESTINATARIO.ID_EMPLEADO
  LEFT JOIN ASUNTO_ATENCION_PARCIAL AT ON AD.ID_ASUNTO = AT.ID_ASUNTO
 INNER JOIN AREA ON REMITENTE.ID_AREA = AREA.ID_AREA
 WHERE AD.ID_EMPLEADO_REMI IN(SELECT ID_EMPLEADO FROM EMPLEADO WHERE
        <isNotEmpty prepend="" property="ids_area">
            <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                ID_AREA =#ids_area[]#
            </iterate>
        </isNotEmpty>
 )
   AND AD.ID_ASUNTO NOT IN (SELECT DISTINCT (A.ID_ASUNTO)
                              FROM ASUNTO A
                             INNER JOIN EMPLEADO REMITENTE ON A.ID_EMPLEADO_REMI = REMITENTE.ID_EMPLEADO
                              LEFT JOIN ASUNTO_ATENCION_PARCIAL AT ON A.ID_ASUNTO = AT.ID_ASUNTO
                             INNER JOIN AREA ON REMITENTE.ID_AREA = AREA.ID_AREA
                             WHERE
        <isNotEmpty prepend="" property="ids_area">
            <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                AREA.ID_AREA =#ids_area[]#
            </iterate>
        </isNotEmpty>
        <isNotNull prepend="" property="id_estatus">
            <isEqual prepend="AND" property="id_estatus" compareValue="0">
                        CASE
                                    WHEN (SELECT ESTATUS_DET
                                            FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL))
                                                   GROUP BY AD3.ID_ASUNTO
                                                ) AD_EST
                                           WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 0 AND A.ESTATUS = 2
                                            THEN 1
                                     WHEN (SELECT ESTATUS_DET
                                             FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL ))
                                                  GROUP BY AD3.ID_ASUNTO
                                                 ) AD_EST
                                            WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 1 AND A.ESTATUS = 2
                                    THEN 1
                                    ELSE A.ESTATUS
                                  END in(0,1)
                      AND AT.COMENTARIO IS NOT NULL
            </isEqual>
            <isEqual prepend="AND" property="id_estatus" compareValue="1">
                        CASE
                                    WHEN (SELECT ESTATUS_DET
                                            FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL))
                                                   GROUP BY AD3.ID_ASUNTO
                                                ) AD_EST
                                           WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 0 AND A.ESTATUS = 2
                                            THEN 1
                                     WHEN (SELECT ESTATUS_DET
                                             FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL ))
                                                  GROUP BY AD3.ID_ASUNTO
                                                 ) AD_EST
                                            WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 1 AND A.ESTATUS = 2
                                    THEN 1
                                    ELSE A.ESTATUS
                                  END = 1
                      AND AT.COMENTARIO IS NULL
            </isEqual>
            <isEqual prepend="AND" property="id_estatus" compareValue="2">
                        CASE
                                    WHEN (SELECT ESTATUS_DET
                                            FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL))
                                                   GROUP BY AD3.ID_ASUNTO
                                                ) AD_EST
                                           WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 0 AND A.ESTATUS = 2
                                            THEN 1
                                     WHEN (SELECT ESTATUS_DET
                                             FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL ))
                                                  GROUP BY AD3.ID_ASUNTO
                                                 ) AD_EST
                                            WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 1 AND A.ESTATUS = 2
                                    THEN 1
                                    ELSE A.ESTATUS
                                  END = 2
            </isEqual>
            <isEqual prepend="AND" property="id_estatus" compareValue="3">
                        CASE
                                    WHEN (SELECT ESTATUS_DET
                                            FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL))
                                                   GROUP BY AD3.ID_ASUNTO
                                                ) AD_EST
                                           WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 0 AND A.ESTATUS = 2
                                            THEN 1
                                     WHEN (SELECT ESTATUS_DET
                                             FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL ))
                                                  GROUP BY AD3.ID_ASUNTO
                                                 ) AD_EST
                                            WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 1 AND A.ESTATUS = 2
                                    THEN 1
                                    ELSE A.ESTATUS
                                  END = 3
            </isEqual>
            <isEqual prepend="AND" property="id_estatus" compareValue="-1">
                  ((A.ESTATUS in (0,1) AND AT.COMENTARIO is not null) OR
                  (A.ESTATUS = 1 AND AT.COMENTARIO is null) OR
                  (A.ESTATUS = 2) OR
                  (A.ESTATUS = 3))
            </isEqual>
        </isNotNull>
        <isNotEmpty prepend="" property="id_area_dest">
            <isGreaterThan prepend="AND" property="id_area_dest" compareValue="-1">
                DESTINATARIO.ID_AREA =#id_area_dest#
            </isGreaterThan>
        </isNotEmpty>

        <isNotNull prepend="" property="fh_registroIni">
            <isNotNull prepend="AND" property="fh_registroFin">
		  A.FH_OFICIO BETWEEN #fh_registroIni# AND #fh_registroFin#
            </isNotNull>
        </isNotNull>
        <isNotNull prepend="" property="id_tema">
            <isNotEqual prepend="AND" property="id_tema" compareValue="-1">
                  A.ID_TEMA = #id_tema#
            </isNotEqual>
        </isNotNull>
        <isNotNull prepend="" property="id_expediente">
            <isNotEqual prepend="AND" property="id_expediente" compareValue="-1">
                  A.ID_EXPEDIENTE = #id_expediente#
            </isNotEqual>
        </isNotNull>

							   )
        <isNotNull prepend="" property="fh_registroIni">
            <isNotNull prepend="AND" property="fh_registroFin">
		  A.FH_OFICIO BETWEEN #fh_registroIni# AND #fh_registroFin#
            </isNotNull>
        </isNotNull>
        <isNotEmpty prepend="" property="id_area_dest">
            <isGreaterThan prepend="AND" property="id_area_dest" compareValue="-1">
                DESTINATARIO.ID_AREA =#id_area_dest#
            </isGreaterThan>
        </isNotEmpty>

        <isNotNull prepend="" property="id_estatus">
            <isEqual prepend="AND" property="id_estatus" compareValue="0">
                        CASE
                                    WHEN (SELECT ESTATUS_DET
                                            FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL))
                                                   GROUP BY AD3.ID_ASUNTO
                                                ) AD_EST
                                           WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 0 AND A.ESTATUS = 2
                                            THEN 1
                                     WHEN (SELECT ESTATUS_DET
                                             FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL ))
                                                  GROUP BY AD3.ID_ASUNTO
                                                 ) AD_EST
                                            WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 1 AND A.ESTATUS = 2
                                    THEN 1
                                    ELSE A.ESTATUS
                                  END in (0,1)
                      AND AT.COMENTARIO IS NOT NULL
            </isEqual>
            <isEqual prepend="AND" property="id_estatus" compareValue="1">
                        CASE
                                    WHEN (SELECT ESTATUS_DET
                                            FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL))
                                                   GROUP BY AD3.ID_ASUNTO
                                                ) AD_EST
                                           WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 0 AND A.ESTATUS = 2
                                            THEN 1
                                     WHEN (SELECT ESTATUS_DET
                                             FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL ))
                                                  GROUP BY AD3.ID_ASUNTO
                                                 ) AD_EST
                                            WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 1 AND A.ESTATUS = 2
                                    THEN 1
                                    ELSE A.ESTATUS
                                  END = 1
                      AND AT.COMENTARIO IS NULL
            </isEqual>
            <isEqual prepend="AND" property="id_estatus" compareValue="2">
                        CASE
                                    WHEN (SELECT ESTATUS_DET
                                            FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL))
                                                   GROUP BY AD3.ID_ASUNTO
                                                ) AD_EST
                                           WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 0 AND A.ESTATUS = 2
                                            THEN 1
                                     WHEN (SELECT ESTATUS_DET
                                             FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL ))
                                                  GROUP BY AD3.ID_ASUNTO
                                                 ) AD_EST
                                            WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 1 AND A.ESTATUS = 2
                                    THEN 1
                                    ELSE A.ESTATUS
                                  END = 2
            </isEqual>
            <isEqual prepend="AND" property="id_estatus" compareValue="3">
                        CASE
                                    WHEN (SELECT ESTATUS_DET
                                            FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL))
                                                   GROUP BY AD3.ID_ASUNTO
                                                ) AD_EST
                                           WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 0 AND A.ESTATUS = 2
                                            THEN 1
                                     WHEN (SELECT ESTATUS_DET
                                             FROM
                                                (SELECT AD3.ID_ASUNTO,
                                                        MAX(AD3.ESTATUS) AS ESTATUS_DET
                                                   FROM ASUNTO_DETALLE AD3
                                                  WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
                                                     ))
                                                     OR AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                                     OR AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL ))
                                                  GROUP BY AD3.ID_ASUNTO
                                                 ) AD_EST
                                            WHERE AD_EST.ID_ASUNTO = A.ID_ASUNTO) = 1 AND A.ESTATUS = 2
                                    THEN 1
                                    ELSE A.ESTATUS
                                  END = 3
            </isEqual>
            <isEqual prepend="AND" property="id_estatus" compareValue="-1">
                  ((A.ESTATUS in (0,1) AND AT.COMENTARIO is not null) OR
                  (A.ESTATUS = 1 AND AT.COMENTARIO is null) OR
                  (A.ESTATUS = 2) OR
                  (A.ESTATUS = 3))
            </isEqual>
        </isNotNull>
        <isNotNull prepend="" property="id_tema">
            <isNotEqual prepend="AND" property="id_tema" compareValue="-1">
                  A.ID_TEMA = #id_tema#
            </isNotEqual>
        </isNotNull>
        <isNotNull prepend="" property="id_expediente">
            <isNotEqual prepend="AND" property="id_expediente" compareValue="-1">
                  A.ID_EXPEDIENTE = #id_expediente#
            </isNotEqual>
        </isNotNull>
       )) B
      WHERE (B.ID IN (SELECT MAX FROM (SELECT MAX(ID_ASUNTO_DETALLE) AS MAX, ID_ASUNTO
                                        FROM  ASUNTO_DETALLE AD3
                                       WHERE (AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>

											))
                                          OR  AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE (
                                                    <isNotEmpty prepend="" property="ids_area">
                                                        <iterate prepend="" property="ids_area" open="(" close=")" conjunction="OR">
                                                            ID_AREA =#ids_area[]#
                                                        </iterate>
                                                    </isNotEmpty>
											))
                                          OR  AD3.ID_EMPLEADO_REMI IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL)
                                          OR  AD3.ID_EMPLEADO_DEST IN (SELECT ID_EMPLEADO FROM EMPLEADO WHERE ID_AREA = NULL))
                                       GROUP BY ID_ASUNTO)) OR B.ID = 0)

    </select>
</sqlMap>